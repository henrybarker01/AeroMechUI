@page "/quotes"
@using AeroMech.UI.Web.Pages.ListTemplate
@using BlazorBootstrap
@using AeroMech.Models
@using AeroMech.UI.Web.Services
@using System.Globalization
@inject NavigationManager Nav
@inject ServiceReportService Service
@inject LoaderService Loader

<PageTitle>Quotes</PageTitle>

<ListTemplate TItem="ServiceReportModel"
          Title="Quotes"
          Items="quotes"
          PageSize="15"
          SearchPredicate="MatchesSearch"
          IsLoading="isLoading"
          OnAdd="NavigateToAddQuote">
    <HeaderTemplate>
        <tr>
            <th>Quote Number</th>
            <th>Report Number</th>
            <th>Report Date</th>
            <th>Serial Number</th>
            <th>Instruction</th>
            <th>Client</th>
            <th>Service Type</th>
            <th>Total</th>
            <th>Status</th>
            <th>Action</th>
        </tr>
    </HeaderTemplate>

    <RowTemplate Context="q">
        <tr>
            <td>@($"AEM {q.QuoteNumber}")</td>
            <td>@($"AEM {q.ServiceReportNumber}")</td>
            <td>@q.ReportDate.ToString("dd/MM/yyyy")</td>
            <td>@q.Vehicle?.SerialNumber</td>
            <td style="max-width:400px">@q.Instruction</td>
            <td>@q.Client?.Name</td>
            <td>@q.ServiceType</td>
            <td>@CalculateTotal(q).ToString("C", CultureInfo.CurrentCulture)</td>
            <td>@(q.IsComplete == true ? "Complete" : "Incomplete")</td>
            <td>
                <Icon Name="IconName.Pencil" Size="IconSize.x5" Class="me-2" Color="IconColor.Primary" @onclick="() => EditQuote(q.Id)" Style="cursor: pointer" />
                <Icon Name="IconName.Printer" Size="IconSize.x5" Color="IconColor.Secondary" @onclick="() => PrintQuote(q.Id)" Style="cursor: pointer" />
            </td>
        </tr>
    </RowTemplate>
</ListTemplate>