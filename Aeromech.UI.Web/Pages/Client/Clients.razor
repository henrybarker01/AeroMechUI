@page "/clients"

<PageTitle>Clients</PageTitle>

<Modal @ref="_modal" Title="@_title">
    <BodyTemplate>
        <EditForm Model="@_client" OnValidSubmit=@AddNewClient>
            <DataAnnotationsValidator />
            <div class="container-fluid">
                <div class="row">
                    <div class="form-group">
                        <label for="Name">Name</label>
                        <InputText @bind-Value=_client.Name class="form-control" id="Name" />
                        <ValidationMessage For="() => _client.Name" />
                    </div>
                </div>
                <div class="row mt-5">
                    <div class="form-group">
                        <label for="contact-person-name">Contact Person Name:</label>
                        <InputText @bind-Value="_client.ContactPersonName" type="text" class="form-control" id="contact-person-name"></InputText>
                        <ValidationMessage For="() => _client.ContactPersonName" />
                    </div>
                </div>
                <div class="row mt-3">
                    <div class="form-group">
                        <label for="contact-person-number">Contact Person Number:</label>
                        <InputText @bind-Value="_client.ContactPersonNumber" type="phone" class="form-control" id="contact-person-nunmer"></InputText>
                        <ValidationMessage For="() => _client.ContactPersonNumber" />
                    </div>
                </div>
                <div class="row mt-3">
                    <div class="form-group">
                        <label for="contact-person-email">Contact Person email:</label>
                        <InputText @bind-Value="_client.ContactPersonEmail" type="email" class="form-control" id="contact-person-email"></InputText>
                        <ValidationMessage For="() => _client.ContactPersonEmail" />
                    </div>
                </div>
                <div class="row mt-3">
                    <div class="form-group">
                        <label for="contact-person-birthdate">Contact Person birth date:</label>
                        <DateInput TValue="DateOnly?" @bind-Value="@_client.ContactPersonBirthDate" id="contact-person-birthdate" />
                        <ValidationMessage For="() => _client.ContactPersonBirthDate" />
                    </div>
                </div>
                <div class="row mt-5">
                    <div class="form-group">
                        <label for="addressLine1">Address Line 1:</label>
                        <InputText @bind-Value="_client.AddressLine1" type="text" class="form-control" id="addressLine1"></InputText>
                        <ValidationMessage For="() => _client.AddressLine1" />
                    </div>
                </div>
                <div class="row mt-3">
                    <div class="form-group">
                        <label for="addressLine2">Address Line 2:</label>
                        <InputText @bind-Value="_client.AddressLine2" type="text" class="form-control" id="addressLine2"></InputText>
                        <ValidationMessage For="() => _client.AddressLine2" />
                    </div>
                </div>
                <div class="row mt-3">
                    <div class="form-group">
                        <label for="city">City:</label>
                        <InputText @bind-Value="_client.City" type="text" class="form-control" id="city"></InputText>
                        <ValidationMessage For="() => _client.City" />
                    </div>
                </div>
                <div class="row mt-3">
                    <div class="form-group">
                        <label for="postalCode">Post Code:</label>
                        <InputText @bind-Value="_client.PostalCode" type="text" class="form-control" id="postalCode"></InputText>
                        <ValidationMessage For="() => _client.PostalCode" />
                    </div>
                </div>

                <div class="row mt-5">
                    <b>Rates:</b>
                    <table class="rate-table">
                        <thead>
                            <tr>
                                <td>
                                    Weekdays
                                </td>
                                <td>
                                    Weekdays Overtime
                                </td>
                                <td>
                                    Sundays & Public Holidays
                                </td>
                                <td>
                                    Overtime
                                </td>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>
                                    <NumberInput TValue="double" @bind-Value="clientRatesWeekdays.Rate" class="form-control" id="clientRatesWeekdays" Step=".01" />
                                    <ValidationMessage For="() => clientRatesWeekdays.Rate" />
                                </td>
                                <td>
                                    <NumberInput TValue="double" @bind-Value="clientRatesWeekdaysOvertime.Rate" class="form-control" id="clientRatesWeekdays" Step=".01" />
                                </td>
                                <td>
                                    <NumberInput TValue="double" @bind-Value="clientRatesSundaysAndPublicHolidays.Rate" class="form-control" id="clientRatesWeekdays" Step=".01" />
                                </td>
                                <td>
                                    <NumberInput TValue="double" @bind-Value="clientRatesOvertime.Rate" class="form-control" id="clientRatesWeekdays" Step=".01" />
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="row">
                <div class="footer-buttons">
                    <div class="close">
                        <Button Color="ButtonColor.Secondary" @onclick="OnHideModalClick">Close</Button>
                    </div>
                    <div>
                        <Button Color="ButtonColor.Primary" Type="ButtonType.Submit">Save changes</Button>
                    </div>
                </div>

            </div>
        </EditForm>
    </BodyTemplate>
</Modal>

<ListTemplate TItem="ClientModel"
              Title="Clients"
              Items="clients"
              PageSize="15"
              SearchPredicate="MatchesSearch"
              ShowAddButton="true"
              OnAdd="OnShowModalClick">
    <HeaderTemplate>
        <tr>
            <th>Name</th>
            <th>Contact Person</th>
            <th>Contact Number</th>
            <th>Contact Email</th>
            <th>Contact Birth Date</th>
            <th class="rate">Weekdays</th>
            <th class="rate">Weekdays Overtime</th>
            <th class="rate">Overtime</th>
            <th class="rate">Sundays & Public Holidays</th>
            <th></th>
        </tr>
    </HeaderTemplate>
    <RowTemplate Context="client">
        <tr>
            <td>@client.Name</td>
            <td>@client.ContactPersonName</td>
            <td>@client.ContactPersonNumber</td>
            <td>@client.ContactPersonEmail</td>
            <td>@client.ContactPersonBirthDate?.ToString("dd/MM/yyyy")</td>
            <td class="rate">@((client.Rates?.FirstOrDefault(x => x.RateType == Models.Enums.RateType.Weekdays)?.Rate ?? 0).ToString("C", CultureInfo.CurrentCulture))</td>
            <td class="rate">@((client.Rates?.FirstOrDefault(x => x.RateType == Models.Enums.RateType.WeekdaysOvertime)?.Rate ?? 0).ToString("C", CultureInfo.CurrentCulture))</td>
            <td class="rate">@((client.Rates?.FirstOrDefault(x => x.RateType == Models.Enums.RateType.Overtime)?.Rate ?? 0).ToString("C", CultureInfo.CurrentCulture))</td>
            <td class="rate">@((client.Rates?.FirstOrDefault(x => x.RateType == Models.Enums.RateType.SundaysAndPublicHolidays)?.Rate ?? 0).ToString("C", CultureInfo.CurrentCulture))</td>
            <td>
                <Icon Name="IconName.BuildingFillDash" Size="IconSize.x5" Color="IconColor.Danger" @onclick="() => DeleteClient(client)" Class="me-2" Style="cursor: pointer" />
                <Icon Name="IconName.BuildingFillGear" Size="IconSize.x5" Color="IconColor.Secondary" @onclick="() => OnEditClientClick(client)" Style="cursor: pointer" />
            </td>
        </tr>
    </RowTemplate>
</ListTemplate>
